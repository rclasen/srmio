
srmio
=====

srmio is a library to access the most important functions of a Schoberer
Radmesstechnik (SRM) PowerControl V. You can download the data, mark it
deleted, sync the time and set the recording interval. So hopefully
you'll get around booting windows after each exercise. Though it is not
intended as a replacement.

To be as compatible as possible, it's reading (SRM6/SRM7) and writing
(SRM7) files in a the format srmwin uses.

For now I consider it to be alpha quality at most. I'm still comparing
it's results for each exercise ...


******* !!! USE IT AT YOUR OWN RISK, IT MIGHT HARM YOUR SRM !!!  ****


Please take this warning serious. I've had no docs for the protocol, so I
had to figure it out myself. While I had luck with srmwin bringing
everything back to normal, you might not.

If you just want to use it, please check
 man srmcmd

Please reade the comments in the source (start with srmio.h) if you want
to use the lib.

Linux:
======

I've used the original prolific-based USB 2 Serial download cable on linux
2.6.27. It shows up as /dev/ttyUSB0 (... or similar).

Cygwin:
=======

Works fine with the original driver from SRM. Shows up as /dev/ttyS4
(com4) or similar. When I've got my first SRM I've had the original
prolific driver installed for a plain usb2serial cable: I've had very bad
results with this driver. The issues vanished (for SRM and the usb2serial
cable) when I've switched to the driver shipped by SRM.

Mac OS X:
=========

With the original prolific drivers, starting the communication succeeded
only occasionaly (around 1 of 15 attempts worked). Once the communication
got established, data transmission worked fine. Reconecting kept working
until the PCV had to be woken up, again. First waking the PCV up by pushing
MODE seemed to improve the success-rate but was still very flaky.
 device: /dev/cu.usbserial
 kextstat:
  106  0 0x8053e000 0x7000 0x6000 com.prolific.driver.PL2303 (1.2.1) <105 33 12>

Once we've switched to the drivers from http://osx-pl2303.sourceforge.net/
all Problems were gone.
 device: /dev/cu.PL2303-* 
 kextstat:
  108  0 0x8056a000 0x7000 0x6000 nl.bjaelectronics.driver.PL2303 (1.0.0d1) <107 33 12>



Notes:
======

Of course I'm open to all suggestions, comments and patches.

If you experience problems with *your* PCV, please
 - recompile with -DDEBUG enabled. 
   (CFLAGS="-g -DDEBUG -Wall -Wextra" ./configure)

If you want to help me adding support for your PCV, please capture the
communication of some successful connections with srmwin:
 - download "portmon" from sysinternals
 - adjust portmon to log function arguments as hex !!!!!. (Options -> Log Hex)
 - send me the portmon logfiles, the resulting .srm files and the output
   from srmcmd with DEBUG output.

Known Problems:
 - might harm an unknown PCV when it sends something the PCV doesn't
   expect.
 - Dates before 1970-1-1 are not supported (SRM usese 1880-1-1 as
   reference). This might lead to problems with bad timestamps or when the
   PC clock is misadjusted.
 - when downloading data, the recint is taken from the first chunks. If it
   changes later on, it's ignored. Well, srmwin seems to ignore the
   recorded recint completely and takes the configured one...
 - downloaded data is always written to a single file. Data isn't split.
   This might cause problems with multi-day recordings.
 - there should be more messages in verbose mode
 - Only writes SRM7 (for now).
 - doesn't use UUCP-Style Lockfiles.
 - result of PC in non-metric display mode is untested.
 - negative temperatures are untested.


Rainer
